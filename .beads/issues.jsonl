{"id":"gains-3kh","title":"Add ChatTyped helper for auto-unmarshal structured output","description":"## Problem\nUsers currently do manual json.Unmarshal after WithResponseSchema:\n```go\nresp, err := c.Chat(ctx, msgs, ai.WithResponseSchema(ai.ResponseSchema{\n    Name: \"book\", Schema: ai.MustSchemaFor[BookInfo](),\n}))\nvar book BookInfo\njson.Unmarshal([]byte(resp.Content), \u0026book)\n```\n\n## Proposed Solution\n```go\nbook, err := client.ChatTyped[BookInfo](ctx, c, msgs)\n// With options\nbook, err := client.ChatTyped[BookInfo](ctx, c, msgs, ai.WithTemperature(0.5))\n```\n\n## Design Decisions\n- Package-level function (Go generics don't allow type params on methods)\n- Signature: `func ChatTyped[T any](ctx context.Context, c *Client, msgs []Message, opts ...Option) (T, error)`\n- Schema name derived from type name via reflection\n- Passes through all options to underlying Chat call\n- Related: workflow.TypedPromptStep does similar for workflows; this is standalone version","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T17:26:31.1855741-08:00","updated_at":"2025-12-17T18:02:41.2093773-08:00","closed_at":"2025-12-17T18:02:41.2093773-08:00","close_reason":"Closed"}
{"id":"gains-4hd","title":"Add type-safe Set for workflow state","description":"## Problem\nThe workflow state allows bypassing the typed Key[T] system:\n```go\nvar KeyCount = workflow.NewKey[int](\"count\")\nstate.Set(\"count\", \"not an int\")  // No compile error!\ncount := workflow.Get(state, KeyCount)  // Runtime panic or zero value\n```\n\n## Proposed Solution\nAdd typed Set function that mirrors Get:\n```go\n// Type-safe set (new)\nworkflow.Set(state, KeyCount, 42)\n// workflow.Set(state, KeyCount, \"not an int\")  // Compile error!\n\n// Signature\nfunc Set[T any](state State, key Key[T], value T)\n```\n\n## Implementation\n- Add `func Set[T any](s State, key Key[T], value T)` to workflow package\n- Deprecate raw `state.Set(string, any)` or make it internal\n- Update existing code to use typed Set","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T17:49:38.8508839-08:00","updated_at":"2025-12-17T18:33:59.7873733-08:00","closed_at":"2025-12-17T18:33:59.7873733-08:00","close_reason":"Set[T] already exists in typed.go. Updated state.go docs to recommend the typed Key[T] API for compile-time type safety."}
{"id":"gains-4zt","title":"Add fluent builder API for tool Registry","description":"## Problem\nCurrent registration is repetitive for many tools:\n```go\nregistry := tool.NewRegistry()\ntool.MustRegisterFunc(registry, \"weather\", \"...\", weatherFn)\ntool.MustRegisterFunc(registry, \"search\", \"...\", searchFn)\ntool.MustRegisterFunc(registry, \"calc\", \"...\", calcFn)\n```\n\n## Proposed Solution\nFluent builder pattern:\n```go\nregistry := tool.NewRegistry().\n    Func(\"weather\", \"Get weather\", weatherFn).\n    Func(\"search\", \"Search web\", searchFn).\n    Func(\"calc\", \"Calculate\", calcFn)\n```\n\n## Design Decisions\n- Panic immediately on each .Func() call (consistent with Must* pattern)\n- No .Build() needed - chain methods return *Registry, ready to use\n- Consider additional methods: .Handler() for interface types, .Tool() for pre-built pairs","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T17:30:37.8407097-08:00","updated_at":"2025-12-17T18:09:18.6902788-08:00","closed_at":"2025-12-17T18:09:18.6902788-08:00","close_reason":"Closed"}
{"id":"gains-d62","title":"Add unified error handling with categories","description":"## Problem\nErrors are inconsistent across packages. No standard way to know if an error is retryable or what action to take.\n\n## Proposed Solution\n```go\n// In gains/errors.go\ntype ErrorCategory string\nconst (\n    ErrorTransient  ErrorCategory = \"transient\"  // retry-able\n    ErrorPermanent  ErrorCategory = \"permanent\"  // don't retry\n    ErrorUserInput  ErrorCategory = \"user_input\" // user must fix\n)\n\ntype CategorizedError interface {\n    error\n    Category() ErrorCategory\n    Retryable() bool           // convenience (Category == Transient)\n    StatusCode() int           // HTTP status if applicable (0 if not)\n    RetryAfter() time.Duration // from header if available (0 if not)\n}\n\n// Helper functions\nfunc IsTransient(err error) bool\nfunc IsPermanent(err error) bool\nfunc IsUserInput(err error) bool\n```\n\n## Design Decisions\n- Interface-based for flexibility (any error can implement it)\n- Include metadata: StatusCode, RetryAfter for richer error handling\n- Helper functions to check category without type assertion\n- Integrate with internal/retry package - only retry transient errors\n- Wrap provider SDK errors with appropriate categories:\n  - 429 Rate Limit → transient\n  - 401 Unauthorized → permanent  \n  - 400 Bad Request → user_input","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T17:35:17.5175731-08:00","updated_at":"2025-12-17T18:28:45.9383285-08:00","closed_at":"2025-12-17T18:28:45.9383285-08:00","close_reason":"Closed"}
{"id":"gains-es9","title":"Add first-class AgentStep to workflow package","description":"## Problem\nThe current NewAgentStep in demos feels bolted-on. Should be a proper Step type in the workflow package.\n\n## Proposed Solution\n```go\ntype AgentStep struct {\n    name      string\n    agent     *agent.Agent\n    prompt    PromptFunc                        // (State) -\u003e []ai.Message\n    mapper    func(*agent.Result, State) error  // Maps agent output to state\n}\n\n// Full control over output mapping\nfunc NewAgentStep(name string, a *agent.Agent, prompt PromptFunc, mapper func(*agent.Result, State) error) *AgentStep\n\n// Convenience: extracts final content to a string key\nfunc NewAgentStepString(name string, a *agent.Agent, prompt PromptFunc, outputKey Key[string]) *AgentStep\n```\n\n## Design Decisions\n- Custom mapper function for flexibility\n- Convenience constructor for common case (string content extraction)\n- Properly integrates with workflow state via Key[T] pattern\n- workflow imports agent (no cycle - agent doesn't import workflow)\n- Should forward/wrap agent events as workflow events","status":"blocked","priority":2,"issue_type":"feature","created_at":"2025-12-17T17:32:21.7698258-08:00","updated_at":"2025-12-17T18:17:47.3950858-08:00"}
{"id":"gains-idz","title":"Add ChatOnce helper for single-turn chat","description":"## Problem\nCurrently the simplest chat requires ~8 lines:\n```go\nc := client.New(client.Config{...})\nresp, err := c.Chat(ctx, []ai.Message{{Role: ai.RoleUser, Content: \"Hello\"}})\n```\n\n## Proposed Solution\nAdd a one-liner helper:\n```go\nresp, err := client.ChatOnce(ctx, \"Hello\", client.WithAPIKey(key), ai.WithModel(model.ClaudeSonnet45))\n```\n\n## Design Decision\n**Approach A**: Support tools via ai.WithTools() but don't execute them automatically. Returns response with ToolCalls if model requests them; caller handles execution. Keeps it simple and predictable.\n\n## Implementation Notes\n- Package-level function in client package\n- Creates ephemeral client internally\n- Supports all ai.Option types\n- Provider selected based on model option\n- No tool execution loop (use agent.Agent for that)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T17:18:54.7290718-08:00","updated_at":"2025-12-17T17:59:49.3141819-08:00","closed_at":"2025-12-17T17:59:49.3141819-08:00","close_reason":"wontfix"}
{"id":"gains-k3g","title":"Remove tools-in-basic-Chat demo and docs","description":"## Context\nAfter review, tools in basic Chat has no coherent use case that isn't better served by:\n- Agent (for tool execution, even single-step with WithMaxSteps(1))\n- ChatTyped (for structured output)\n\nThe current demo teaches a pattern nobody should use in production.\n\n## Changes\n1. Remove cmd/demo/tools.go (manual two-round tool loop example)\n2. Update README to not show tools with basic Chat\n3. Update any godoc that suggests using WithTools directly\n4. Keep WithTools public (Agent uses it internally) but don't document for direct use\n\n## Files to Review\n- cmd/demo/tools.go - DELETE\n- README.md - remove tool examples with basic Chat\n- doc.go - update if needed\n- options.go godoc - consider noting 'used internally by Agent'","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:45:57.657638-08:00","updated_at":"2025-12-17T18:32:07.0076683-08:00","closed_at":"2025-12-17T18:32:07.0076683-08:00","close_reason":"Closed"}
